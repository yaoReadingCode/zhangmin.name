title: YOURLS改造总结
tags:
  - 技术
  - 札记
id: 1609
categories:
  - MSE
date: 2013-05-17 22:59:02
---

这是大规模web性能优化的小组作业是对一个系统进行改造，以实现性能的改进。在项目的立项阶段主要是找一个应用可以利用memcachedb进行改造。经过memcachedb调研后知道memcachedb适合需要频繁读写的小数据的场景。例如数字类服务就像点击数，需要频繁写入小数据的例如评论系统，需要记录用户状态的例如在线人数以及在线用户等等。最后找到了YOURLS这个短网址程序，是基于PHP和MySQL开发的。先开始我认为可以将mysql数据库直接替换成memcachedb，经过研读源代码，发现这样不太现实，基本需要重写大半部分的核心代码。进一步分析代码后，发现YOURLS是可以基于plugin进行扩展，而且也有一个类似的APC缓存插件，所以我们决定使用插件改造这个系统。
在实现阶段，主要就是编写插件函数将短网址和长网址之间的映射保存到memcachedb中，这样可以减少大量的数据库读写。同时还要对链接的点击次数，在一定的时间内将点击次数先写到缓存中，时间过后再统一写到数据库中。另外，还要将日志的记录也要写入到缓存。可以确认，缓存后，响应时间会大幅度下降。
改造完后的第一个感觉就是YOURLS设计的很巧妙，plugin机制可以让开发者不修改核心的代码就可以修改应用程序的大部分功能,非常灵活多变。这也是我将来在应用开发过程中需要学习的。